<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<script src="/_resource/js/_js_initialLoadFiles.min.js"></script>
</head>
<body>

  <h1>.axd：直接在.cs類別（DLL）裡面實作IHttpHandler</h1>

  <p>在ASP.NET WebForm中，我們要高速的進行一些運算處理往往會選擇.ashx（泛型處理常式），來幫我們跳過煩人緩慢的System.Web.UI.Page類別所引爆的事件生命週期。.ashx很好用，但往往很少人知道還有一個.axd副檔名的存在，今天就來介紹一下.axd的用法。</p>

  <img src="/image/2020/20200410_01.jpg" />

  <h3>.ashx與.axd是攣生兄弟但少了實體路徑</h3>
  <p>不知道你是否有發生過兩個大致上處理同樣事情，只有些許不一樣的.ashx撰寫經驗，往往我們會進行的是把這個同樣事情的程式碼寫成.cs類別檔案並往/bin目錄塞，然後外面再包皮.ashx來調用，不一樣的.ashx進行同樣類別的調用但處理不太一樣的事情，大致上這樣的使用是沒有問題的。</p>

  <p>如果有一天你需要直接調用\bin下面的純類別，你可能又要包皮一隻.ashx，然後再去調用這個純類別。</p>

  <p>.axd的出現就是要解決這個痛點，它同樣實作了System.Web.IHttpHandler，且可以用一種近似Url Rewrite的方法來調用，如此一來你就不必再寫一隻包皮.ashx，直接把你要做的事情寫在這個類別檔案裡面就可以了。</p>

  <p>再更直白地說一句：</p>
<pre>
.axd是一種可透過網址直接調用DLL的技術。
</pre>

  <h3>簡單.axd範例</h3>
  <p>Step 1. 將你常用的.ashx寫法，存成.cs類別檔並放到/bin目錄下。</p>
<pre class="C#">
namespace YourCompany.Utility
{
  public class SaySomething : System.Web.IHttpHandler
  {
    public void ProcessRequest(System.Web.HttpContext oContext)
    {
      string cTemp = oContext.Request["cMsg"] as string;
      //如果沒有參數就顯示預設值
      if (string.IsNullOrEmpty(cTemp))
      { cTemp = "Hello World!"; }
      oContext.Response.Write(cTemp);
    }
    public bool IsReusable { get { return false; } }
  }
}
</pre>

  <p>Step 2. 將這個類別檔案註冊到web.config之中。這裡要特別注意的是，很多介紹.asd的網頁都叫你去用system.web＞httpHandlers標籤註冊，這是錯誤的做法，因為這是早期IIS應用程式集區（Application Pools）的Managed管線模式（Managed Pipeline Mode）為典型（Classic mode）的寫法。IIS的應用程式集區現代大部分都被設定成整合式（Integrated mode），所以正確的做法應該是system.webServer＞handlers才對。</p>
  <p>以下範例：</p>
<pre>
&lt;system.webServer&gt;    
  &lt;handlers&gt;
    &lt;add verb="*" name="MyAxdTest" path="Hello.axd" type="YourCompany.Utility.SaySomething" /&gt;
  &lt;/handlers&gt;
&lt;/system.webServer&gt;
</pre>

  <p>大功告成，開始測試！</p>

  <p>請輸入網址：</p>
<pre class="plaintext">
//輸出Hello World!
http://localhost/Hello.axd
//輸出Hi There
http://localhost/Hello.axd?cMsg=Hi%20There
</pre>

  <h4>喔對了！忘了告訴你.axd副檔名其實是沒有具體意義的！</h4>

  <p>把.axd拿掉同樣可以動作喔，且網址更精緻可閱讀，可拿來進行SEO優化！</p>
<pre>
&lt;system.webServer&gt;    
  &lt;handlers&gt;
    &lt;add verb="*" name="MyAxdTest" path="Hello" type="YourCompany.Utility.SaySomething" /&gt;
  &lt;/handlers&gt;
&lt;/system.webServer&gt;
</pre>

  <p>測試網址沒有.axd的效果：</p>
<pre class="plaintext">
//輸出Hello World!
http://localhost/Hello
//輸出Hi There
http://localhost/Hello?cMsg=Hi%20There
</pre>

  <p>.axd的使用其實是WebForm末期很方便的做法，無奈Url Rewrite與ASP.NET MVC Routing的崛起與成熟，導致這項技巧沒有受到很多人的重視，如果你有這方面的需求的話，其實它是一種很快速有效率的技巧喔。</p>

  <p>相關連結：<a href="/archive2019/20190125.html" target="_blank">在ASP.NET網站中啟用內建的Trace訊息追蹤功能</a></p>


  <small>.ashx .axd UrlRewrite ASP.NET MVC Routing DirectCallDLL</small>

</body>
</html>
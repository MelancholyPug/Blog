<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<script src="/_resource/js/_js_initialLoadFiles.min.js"></script>
</head>
<body>

<h1>謎案探討：Runtime Broker大量耗用CPU的問題</h1>

<p>今天工作的時候發現，自己的電腦背景被一隻叫做Runtime Broker的處理程序大量耗用CPU運算資源，到網路上發現這隻程式原來是微軟的UWP用來進行背景處理時，會去調用的執行續，他會針對不同的UWP下所建立的Thread，自己一直建立新實體出來。在2015年Windows 10剛發表的時候，據說是設定＞系統＞通知與動作下的「顯示關於Windows的提示」這個設定發生問題，關掉就好（網路上大概找到的都是這個解答）。可是時至2016年了，該修正的東西早就修正完成了，那麼為何還是出現這個看似錯誤的誤動作呢？</p>

<p>打開工作管理員，東想西找，最後才發現我好像是開了Groove程式才開始發生這些問題，在網路找一下果然有人提出這個問題來，可是沒有人有解答。</p>

<h3>接下來就是Debug的時間了！</h3>

<p>打開工作管理員後，發現Runtime Broker如圖，但是也有另外發現，我並沒有在進行檔案異動的OneDrive好像也默默的在消耗我的CPU運算資源。</p>

<a href="https://www.flickr.com/photos/105479788@N06/25229458393"><img src="https://c1.staticflickr.com/1689/25229458393_0379930484_o.png" alt="20160317_01"></a>

<p>再把工作管理員往拉一看，發現不得了，一大堆稱為「Microsoft OneDriveFile Co-Authoring Executable」的處理程序一直不斷的產生與消失，這表示極有可能是Runtime Broker這隻程式去不斷的調用所致。</p>

<a href="https://www.flickr.com/photos/105479788@N06/25760935791"><img src="https://c1.staticflickr.com/1610/25760935791_43b1b8d360_o.png" alt="20160317_02"></a>

<p>有了這樣的懷疑推論，直接開「資源監視器」看一下，果然發現兇手，答案就是Runtime Broker在對我OneDrive的音樂檔案進行雜湊（猜測），或許是在建立manifest或index之類的檔案吧。</p>

<a href="https://www.flickr.com/photos/105479788@N06/25830002886"><img src="https://c1.staticflickr.com/1694/25830002886_073acddefe_o.png" alt="20160317_03"></a>

<h3>Don't Worry, you should do nothing!</h3>
<p>有了這樣的推論之後就放心了，放給他跑一陣子，在Intel i7 CPU的加持下，過不到30分鐘，我的OneDrive雲端音樂檔案（大約快50GB）就處理完了。一旦處理完成，Runtime Broker耗用CPU的程度就馬上變成0%了。</p>

<p>謎案解除！</p>

<h3>後記１</h3>

<p>結至2016-12-20為止，微軟仍然沒有針對OneDrive存放大量音樂檔案時，與Groove音樂播放器互動時產生的大量RuntimeBroker.exe，提出有效的修正方案。</p>

<p>若想要針對每次重新開機引發這樣高CPU、高耗能的暫時解決方案，最有可能的方式就是請將OneDrive裡面的音樂利用Script等級的方式複製一份到本地端的音樂資料夾，然後再將Groove APP裡面的音樂資料夾指向到該本地端資料夾，接著在Groove APP中「移除OneDrive音樂資料夾」的參考，如此一來可以先解決目前的困境。</p>

<h3>後記２</h3>

<p>2017-04 / After Microsoft Creator Update 15063.13 and Windows 10 Version 1703 HotFix（KB4015583），the RuntimeBroker issues seems to fixed.</p>

<small>RuntimeBroker OneDrive Groove Music MP3 CPU Useage</small>

</body>
</html>
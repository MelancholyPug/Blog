<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<script src="/_resource/js/_js_initialLoadFiles.min.js"></script>
</head>
<body>

<h1>利用Windows Server架設VPN伺服器</h1>

<p>網路上利用Windows Server來架設伺服器的文章非常的多，但是真正命中要點的卻是非常的少，我想大部份的需求都是想要透過第三方電腦／網域，撥接回家中的伺服器，來達成跨網域存取（翻牆）的作用才是，但是網路上大部份的文章，針對這部份卻是點到為止，例如：進行區網內部NAT至外部、或者是外部VPN回區網、或者是教你架設VPN伺服器，但是一定要兩片網路卡。</p>

<p>看到這一篇文章算是你的幸運，保證架設VPN只要一片網路卡就可以了，詳細步驟如下（圖多請稍候）：</p>

<p>Setp 01. 進入伺服器管理員＞新增角色及功能。</p>
<a href="https://www.flickr.com/photos/105479788@N06/15457922263"><img src="https://c1.staticflickr.com/8612/15457922263_8a13f9ea04_o.png" alt="20141222_01"></a>

<p>Setp 02. 跟著功能精靈一步步往下走。</p>
<a href="https://www.flickr.com/photos/105479788@N06/15891496399"><img src="https://c1.staticflickr.com/8614/15891496399_c200386e54_o.png" alt="20141222_02"></a>
<a href="https://www.flickr.com/photos/105479788@N06/15891821837"><img src="https://c1.staticflickr.com/8661/15891821837_fc94bff0e9_o.png" alt="20141222_03"></a>
<a href="https://www.flickr.com/photos/105479788@N06/16051783516"><img src="https://c1.staticflickr.com/8610/16051783516_6b422e7413_o.png" alt="20141222_04"></a>

<p>Setp 03. 這裡要勾選Remote Access以及同意安裝關聯元件。</p>
<a href="https://www.flickr.com/photos/105479788@N06/16076881972"><img src="https://c1.staticflickr.com/7464/16076881972_bd35b31f9c_o.png" alt="20141222_05"></a>
<a href="https://www.flickr.com/photos/105479788@N06/15890296410"><img src="https://c1.staticflickr.com/8651/15890296410_304a9e7f5c_o.png" alt="20141222_06"></a>
<a href="https://www.flickr.com/photos/105479788@N06/15890296430"><img src="https://c1.staticflickr.com/7514/15890296430_9e7f49a2f6_o.png" alt="20141222_07"></a>

<p>Setp 04. 繼續往下安裝。</p>
<a href="https://www.flickr.com/photos/105479788@N06/15890143698"><img src="https://c1.staticflickr.com/7490/15890143698_cf6dcc31e1_o.png" alt="20141222_08"></a>
<a href="https://www.flickr.com/photos/105479788@N06/15891821757"><img src="https://c1.staticflickr.com/7523/15891821757_6ac03f9b71_o.png" alt="20141222_09"></a>

<p>Setp 05. 這邊要把Routing勾選起來。</p>
<a href="https://www.flickr.com/photos/105479788@N06/15890143668"><img src="https://c1.staticflickr.com/8561/15890143668_1a5cccb12b_o.png" alt="20141222_10"></a>
<a href="https://www.flickr.com/photos/105479788@N06/16076881872"><img src="https://c1.staticflickr.com/7503/16076881872_23bf29c4d6_o.png" alt="20141222_11"></a>

<p>Setp 06. 接下來系統會提示裝一些IIS的元件，基本上都是Pass過去。</p>
<a href="https://www.flickr.com/photos/105479788@N06/16075658091"><img src="https://c1.staticflickr.com/8623/16075658091_a7a59fc9d0_o.png" alt="20141222_12"></a>
<a href="https://www.flickr.com/photos/105479788@N06/15890143558"><img src="https://c1.staticflickr.com/7549/15890143558_be7f15206a_o.png" alt="20141222_13"></a>

<p>Setp 07. 可以的話，勾選一下「必要時自動重新啟動目的伺服器」後，點選安裝鈕。</p>
<a href="https://www.flickr.com/photos/105479788@N06/16076881772"><img src="https://c1.staticflickr.com/7517/16076881772_7f1a990a75_o.png" alt="20141222_14"></a>
<a href="https://www.flickr.com/photos/105479788@N06/15890296280"><img src="https://c1.staticflickr.com/7523/15890296280_5b236a2df5_o.png" alt="20141222_15"></a>

<p>Setp 08. 安裝完成後，點選伺服器管理員＞工具＞遠端存取管理</p>
<a href="https://www.flickr.com/photos/105479788@N06/15455277844"><img src="https://c1.staticflickr.com/7513/15455277844_bc7baaea25_o.png" alt="20141222_16"></a>

<p>Setp 09. 開啟後點選右側的「開啟RRAS管理」。</p>
<a href="https://www.flickr.com/photos/105479788@N06/15890296200"><img src="https://c1.staticflickr.com/7567/15890296200_a4f6eb695f_o.png" alt="20141222_17"></a>

<p>Setp 10. 接著系統就會自動開啟「路由及遠端存取」管理，選取你自己的伺服器名稱根目錄，然後右鍵選取「設定和啟用路由及遠端存取」功能。</p>
<a href="https://www.flickr.com/photos/105479788@N06/15457922013"><img src="https://c1.staticflickr.com/7468/15457922013_924e9bafb9_o.png" alt="20141222_18"></a>

<p>Setp 11. 跟著精靈去逐步安裝。</p>
<a href="https://www.flickr.com/photos/105479788@N06/16075657931"><img src="https://c1.staticflickr.com/8601/16075657931_ba0ce63201_o.png" alt="20141222_19"></a>

<p>Setp 12. 單片網路卡的情況之下，請一定要選「自訂設定」。</p>
<a href="https://www.flickr.com/photos/105479788@N06/16075657891"><img src="https://c1.staticflickr.com/8598/16075657891_039ea3837b_o.png" alt="20141222_20"></a>

<p>Setp 13. 勾選VPN以及NAT服務。</p>
<a href="https://www.flickr.com/photos/105479788@N06/15455277784"><img src="https://c1.staticflickr.com/7486/15455277784_f99af55b28_o.png" alt="20141222_21"></a>

<p>Setp 14. 點選完成。</p>
<a href="https://www.flickr.com/photos/105479788@N06/16077582165"><img src="https://c1.staticflickr.com/8577/16077582165_6538955900_o.png" alt="20141222_22"></a>

<p>Setp 15. 接著系統會提示你是否要啟動RRAS服務，當然就是點選「啟動服務」嘍。</p>
<a href="https://www.flickr.com/photos/105479788@N06/16075657901"><img src="https://c1.staticflickr.com/7547/16075657901_1718991a0c_o.png" alt="20141222_23"></a>

<h3>設定私有IP分配表</h3>

<p>Setp 16. 點選你的伺服器名稱根目錄＞右鍵＞內容。</p>
<a href="https://www.flickr.com/photos/105479788@N06/16051783226"><img src="https://c1.staticflickr.com/7526/16051783226_f9f9306744_o.png" alt="20141222_24"></a>

<p>Setp 17. 點選IPv4頁面，選擇「鏡態位址集區」，點選新增。</p>
<a href="https://www.flickr.com/photos/105479788@N06/15457921963"><img src="https://c1.staticflickr.com/8594/15457921963_545d6cc7a9_o.png" alt="20141222_25"></a>

<p>Setp 18. 這邊是隨便輸入個Private IP：192.168.1.1～192.168.1.100，共100組，如果你是個人用的話是不需要這麼多組的。</p>
<a href="https://www.flickr.com/photos/105479788@N06/15891496039"><img src="https://c1.staticflickr.com/8593/15891496039_c36d0c0b8a_o.png" alt="20141222_26"></a>

<h3>新增NAT介面，讓它可以路由出去Internet</h3>

<p>Setp 19. 點開IPv4目錄，找到NAT項次，按右鍵選「新增介面」，從這個步驟開始很多網站都不會跟你說明！</p>
<a href="https://www.flickr.com/photos/105479788@N06/15891821487"><img src="https://c1.staticflickr.com/8655/15891821487_590fb05d8e_o.png" alt="20141222_27"></a>

<p>Setp 20. 挑選你要的介面，我們這邊選的是Ethernet，基本上這個名稱就是你的伺服器上唯一的一片網卡的名稱。</p>
<a href="https://www.flickr.com/photos/105479788@N06/16075658291"><img src="https://c1.staticflickr.com/7539/16075658291_ae552f9434_o.png" alt="20141222_28"></a>

<p>Setp 21. 把這個介面掛上NAT吧！</p>
<a href="https://www.flickr.com/photos/105479788@N06/15891496499"><img src="https://c1.staticflickr.com/8674/15891496499_c2a37d6266_o.png" alt="20141222_29"></a>

<h3>建立撥接者帳號</h3>

<p>Setp 22. 伺服器管理員＞工具＞電腦管理。</p>
<a href="https://www.flickr.com/photos/105479788@N06/16077582605"><img src="https://c1.staticflickr.com/7529/16077582605_8901ccf6fd_o.png" alt="20141222_30"></a>

<p>Setp 23. 自己新增一個帳號，來實驗撥接用。</p>
<a href="https://www.flickr.com/photos/105479788@N06/15891496459"><img src="https://c1.staticflickr.com/8648/15891496459_93108761f5_o.png" alt="20141222_31"></a>

<p>Setp 24. 接下來這一點也很重要，很多人都沒有給這個帳號撥入的權限，自然在Windows 7或Windows 8端就無法設定VPN嘍！</p>
<a href="https://www.flickr.com/photos/105479788@N06/16076882072"><img src="https://c1.staticflickr.com/7547/16076882072_dc54133171_o.png" alt="20141222_32"></a>
<a href="https://www.flickr.com/photos/105479788@N06/15890296480"><img src="https://c1.staticflickr.com/8576/15890296480_18799de387_o.png" alt="20141222_33"></a>

<p>基本上VPN撥接伺服器到此完成！Windows Workstation Client端的VPN設定網路上應該一大堆文章，再此我就不多做介紹了。</p>

<h3>同場加映：防火牆設定值</h3>
<p>基本上你做完上面的服務設定，Windows會自動幫你把防火牆應該打通的Port開啟，如果你想要深入的逐一開啟也可以，請參考下列的資訊自己實驗看看。</p>
<pre>
PPTP: 1723/TCP
L2TP: 1701/TCP, 500/UDP
SSTP: 443/TCP
</pre>

<small>WindowsServer WindowsServer2012 WindowsServer2012R2 NAT VPN PPTP L2TP SSTP</small>

</body>
</html>